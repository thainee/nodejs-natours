{"mappings":"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","sources":["public/js/index.js","public/js/login.js","public/js/alert.js","public/js/mapbox.js","public/js/updateData.js","public/js/stripe.js"],"sourcesContent":["import { handleLogin, handleLogout } from './login.js';\r\nimport { displayMap } from './mapbox.js';\r\nimport { updateUserAccount } from './updateData.js';\r\nimport { bookTour } from './stripe.js';\r\nimport { showAlert } from './alert.js';\r\n\r\n// DOM ELEMENTS\r\nconst loginForm = document.querySelector('.form--login');\r\nconst mapBox = document.getElementById('map');\r\nconst logoutBtn = document.querySelector('.nav__el--logout');\r\nconst userSettingsForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-settings');\r\nconst bookBtn = document.getElementById('book-tour');\r\n\r\n// DELEGATION\r\nif (mapBox) {\r\n  const locations = JSON.parse(mapBox.dataset.locations);\r\n  displayMap(locations);\r\n}\r\n\r\nif (loginForm) {\r\n  loginForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const email = document.getElementById('email').value;\r\n    const password = document.getElementById('password').value;\r\n    handleLogin({ email, password });\r\n  });\r\n}\r\n\r\nif (userSettingsForm) {\r\n  userSettingsForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    document.querySelector('.btn--save-settings').textContent = 'Updating...';\r\n    const form = new FormData();\r\n    form.append('name', document.getElementById('name').value);\r\n    form.append('password', document.getElementById('password').value);\r\n    form.append('photo', document.getElementById('photo').files[0]);\r\n    await updateUserAccount(form, 'data');\r\n    document.querySelector('.btn--save-settings').textContent = 'Save settings';\r\n  });\r\n}\r\n\r\nif (userPasswordForm) {\r\n  userPasswordForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    document.querySelector('.btn--save-password').textContent = 'Updating...';\r\n    let currentPassword = document.getElementById('password-current').value;\r\n    let password = document.getElementById('password').value;\r\n    let passwordConfirm = document.getElementById('password-confirm').value;\r\n    await updateUserAccount(\r\n      { currentPassword, password, passwordConfirm },\r\n      'password',\r\n    );\r\n    document.querySelector('.btn--save-password').textContent = 'Save password';\r\n    document.getElementById('password-current').value = '';\r\n    document.getElementById('password').value = '';\r\n    document.getElementById('password-confirm').value = '';\r\n  });\r\n}\r\n\r\nif (logoutBtn) {\r\n  logoutBtn.addEventListener('click', handleLogout);\r\n}\r\n\r\nif (bookBtn) {\r\n  bookBtn.addEventListener('click', (e) => {\r\n    e.target.textContent = 'Processing...';\r\n    const { tourId } = e.target.dataset;\r\n    bookTour(tourId);\r\n    e.target.textContent = 'Book tour now!';\r\n  });\r\n}\r\n\r\nconst alertMessage = document.querySelector('body').dataset.alert;\r\nif (alert) showAlert('success', alertMessage, 10);\r\n","/* eslint-disable */\r\nimport { showAlert } from './alert.js';\r\n\r\nexport async function handleLogin(data) {\r\n  try {\r\n    const response = await axios.post(\r\n      `${process.env.BASE_URL}/api/v1/users/login`,\r\n      data,\r\n    );\r\n\r\n    if (response.data.status === 'success') {\r\n      showAlert('success', 'Logged in successfully!');\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 800);\r\n    }\r\n  } catch (error) {\r\n    showAlert('error', error.response.data.message);\r\n  }\r\n}\r\n\r\nexport async function handleLogout() {\r\n  try {\r\n    const response = await axios.get(\r\n      `${process.env.BASE_URL}/api/v1/users/logout`,\r\n    );\r\n\r\n    if (response.data.status === 'success') {\r\n      location.reload(true);\r\n      showAlert('success', 'Logged out successfully!');\r\n    }\r\n  } catch (error) {\r\n    showAlert('error', error.response.data.message);\r\n  }\r\n}\r\n","export const hideAlert = () => {\r\n  const el = document.querySelector('.alert');\r\n  if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\nexport const showAlert = (type, msg, time = 3) => {\r\n  hideAlert();\r\n\r\n  const markup = `<div class='alert alert--${type}'>${msg}</div>`;\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n\r\n  window.setTimeout(hideAlert, time * 3);\r\n};\r\n","/* eslint-disable */\r\nexport const displayMap = (locations) => {\r\n  mapboxgl.accessToken = process.env.MAPBOX_ACCESS_TOKEN;\r\n\r\n  const map = new mapboxgl.Map({\r\n    container: 'map', // container ID\r\n    // center: [-74.5, 40], // starting position [lng, lat]. Note that lat must be set between -90 and 90\r\n    // zoom: 9, // starting zoom\r\n    projection: 'mercator',\r\n  });\r\n\r\n  const bounds = new mapboxgl.LngLatBounds();\r\n\r\n  locations.forEach((loc) => {\r\n    // Create marker\r\n    const el = document.createElement('div');\r\n    el.className = 'marker';\r\n\r\n    // Add marker\r\n    new mapboxgl.Marker({\r\n      element: el,\r\n      anchor: 'bottom',\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .addTo(map);\r\n\r\n    // Add popup\r\n    new mapboxgl.Popup({\r\n      offset: 30,\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\r\n      .addTo(map);\r\n\r\n    // Extend map bounds to include current location\r\n    bounds.extend(loc.coordinates);\r\n  });\r\n\r\n  map.fitBounds(bounds, {\r\n    padding: {\r\n      top: 200,\r\n      bottom: 150,\r\n      left: 100,\r\n      right: 100,\r\n    },\r\n  });\r\n};\r\n","/* eslint-disable */\r\nimport { showAlert } from './alert.js';\r\n\r\nexport async function updateUserAccount(data, type) {\r\n  try {\r\n    let url = `${process.env.BASE_URL}/api/v1/users`;\r\n    url += type === 'password' ? '/update-password' : '/update-me';\r\n    const res = await axios.patch(url, data);\r\n\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', `${type} updated successfully!`);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n}\r\n","/* eslint-disable */\r\nimport { showAlert } from './alert.js';\r\nvar stripe = Stripe(process.env.STRIPE_PUBLIC_KEY);\r\n\r\nexport const bookTour = async (tourId) => {\r\n  try {\r\n    // 1) Get checkout session from API\r\n    const session = await axios.get(\r\n      `${process.env.BASE_URL}/api/v1/bookings/checkout-session/${tourId}`,\r\n    );\r\n\r\n    // 2) Create checkout form + charge credit card\r\n    await stripe.redirectToCheckout({\r\n      sessionId: session.data.session.id,\r\n    });\r\n  } catch (err) {\r\n    console.log(err);\r\n    showAlert('error', err);\r\n  }\r\n};\r\n"],"names":[],"version":3,"file":"bundle.js.map"}